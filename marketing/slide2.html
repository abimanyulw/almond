<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Almond Polaroid Cam â€” Sort Letters Game (Uniform Boxes)</title>

  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;600&family=Yeseva+One&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #1E2A36;
      --accent: #D6A889;
      --muted: rgba(214,168,137,0.08);
      --card-padding: 14px;
      --gap: 8px;
      --min-cell: 28; /* px minimum touchable */
      --max-cell: 54; /* px maximum normal */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(214,168,137,0.03), transparent 8%),
                  linear-gradient(180deg, var(--bg), #122029 140%);
      color:var(--accent);
      font-family: "Josefin Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:12px;
      overflow-x: hidden;
    }

    .card {
      width:100%;
      max-width:820px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:var(--card-padding);
      box-shadow: 0 10px 30px rgba(2,6,10,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      border: 1px solid rgba(214,168,137,0.12);
      margin: 12px 0;
    }

    /* stacked layout */
    .stack { display:flex; flex-direction:column; gap:12px; }

    .word-card {
      background: linear-gradient(180deg, rgba(214,168,137,0.02), transparent);
      border-radius:10px;
      border:1px dashed rgba(214,168,137,0.06);
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
      justify-content:center;
      min-height:96px;
      width:100%;
    }

    .target-row {
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      flex-wrap:nowrap;
      width:100%;
      overflow:visible;
      padding:4px 2px;
    }

    .letters-row {
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      flex-wrap:nowrap;
      width:100%;
      padding:4px 2px;
    }

    .slot, .letter-btn {
      box-sizing: border-box;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:8px;
      text-transform:uppercase;
      user-select:none;
      -webkit-user-select:none;
      border: 2px dashed rgba(214,168,137,0.14);
      background: rgba(255,255,255,0.01);
      color: var(--accent);
      font-weight:700;
      font-family: "Josefin Sans", sans-serif;
    }

    .letter-btn {
      border: 2px solid #d2ac95;
      background: #d2ac95;
      color: #1f2a35;
      cursor: pointer;
      padding:4px;
      min-width: var(--min-cell);
      height: var(--min-cell);
      font-size: 14px;
    }
    .letter-btn.disabled { opacity:0.36; cursor:default; transform:scale(0.98); }

    .slot {
      padding:4px;
      min-width: var(--min-cell);
      height: var(--min-cell);
      font-size:14px;
    }

    .controls {
      display:flex;
      gap:8px;
      justify-content:center;
      margin-top:8px;
      flex-wrap:nowrap;
      overflow-x:auto;
      padding-bottom:6px;
    }

    .btn {
      background: #d2ac95;
      color: #1f2a35;
      border: none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-family: "Josefin Sans", sans-serif;
      min-width:72px;
      white-space:nowrap;
    }

    .message {
      margin-top:10px;
      padding:8px;
      border-radius:8px;
      background: var(--muted);
      color: var(--accent);
      text-align:center;
      font-weight:600;
    }

    @media (max-width:520px){
      .card{ padding:10px; }
      .word-card{ min-height:88px; gap:6px; }
      .letter-btn, .slot { font-size:13px; }
    }
  </style>
</head>
<body>
  <div class="card" role="main">
    <div class="stack" id="stack">
      <div class="word-card" data-index="0">
        <div class="target-row" id="target-0" aria-label="target 1"></div>
        <div class="letters-row" id="letters-0" aria-label="letters 1"></div>
      </div>

      <div class="word-card" data-index="1">
        <div class="target-row" id="target-1" aria-label="target 2"></div>
        <div class="letters-row" id="letters-1" aria-label="letters 2"></div>
      </div>

      <div class="word-card" data-index="2">
        <div class="target-row" id="target-2" aria-label="target 3"></div>
        <div class="letters-row" id="letters-2" aria-label="letters 3"></div>
      </div>
    </div>

    <div class="controls" id="controls">
      <button class="btn" id="undoBtn" type="button">Undo</button>
      <button class="btn" id="resetBtn" type="button">Reset</button>
      <button class="btn" id="checkBtn" type="button">Check</button>
    </div>

    <div id="message" class="message" style="display:none" role="status"></div>
  </div>

  <script>
    const words = ["ALMOND", "POLAROID", "CAM"];
    const MIN = 28; // px
    const MAX = 54; // px
    const GAP = 8;  // px

    const placed = words.map(w => []);
    const history = [];

    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

    function createUI(){
      words.forEach((w, wi) => {
        const lettersContainer = document.getElementById('letters-' + wi);
        const targetContainer = document.getElementById('target-' + wi);
        lettersContainer.innerHTML = '';
        targetContainer.innerHTML = '';

        const chars = shuffle(w.split(''));
        chars.forEach((ch, idx) => {
          const btn = document.createElement('button');
          btn.className = 'letter-btn';
          btn.type = 'button';
          btn.textContent = ch;
          btn.id = `w${wi}-c${idx}`;
          btn.dataset.letter = ch;
          btn.dataset.wordIndex = wi;
          btn.onclick = () => onLetterClick(wi, btn.id);
          lettersContainer.appendChild(btn);
        });

        for(let i=0;i<w.length;i++){
          const slot = document.createElement('div');
          slot.className = 'slot';
          slot.dataset.index = i;
          slot.dataset.wordIndex = wi;
          slot.textContent = '';
          targetContainer.appendChild(slot);
          placed[wi][i] = null;
        }
      });

      history.length = 0;
      showMessage('', false);
      adjustUniformSizeFromWord2();
    }

    // compute cell size based on word 2, then apply that size to all words
    function adjustUniformSizeFromWord2(){
      const word2Card = document.querySelector('.word-card[data-index="1"]');
      if(!word2Card) return;
      const cardPadding = 12; // fudge for inner paddings
      const totalWidth = Math.max(120, word2Card.clientWidth - cardPadding);
      const cellsForWord2 = Math.max(
        document.querySelectorAll('#letters-1 .letter-btn').length,
        document.querySelectorAll('#target-1 .slot').length,
        1
      );
      let cellSize = Math.floor((totalWidth - (cellsForWord2 - 1) * GAP) / cellsForWord2);
      if(isNaN(cellSize) || cellSize <= 0) cellSize = MIN;
      cellSize = Math.max(MIN, Math.min(MAX, cellSize));

      // apply to all words uniformly
      words.forEach((w, wi) => {
        document.querySelectorAll(`#letters-${wi} .letter-btn`).forEach(btn => {
          btn.style.width = cellSize + 'px';
          btn.style.height = cellSize + 'px';
          btn.style.fontSize = Math.max(12, Math.floor(cellSize * 0.45)) + 'px';
        });
        document.querySelectorAll(`#target-${wi} .slot`).forEach(slot => {
          slot.style.width = cellSize + 'px';
          slot.style.height = cellSize + 'px';
          slot.style.fontSize = Math.max(12, Math.floor(cellSize * 0.40)) + 'px';
        });
      });
    }

    function onLetterClick(wordIndex, btnId){
      const btn = document.getElementById(btnId);
      if(!btn || btn.classList.contains('disabled')) return;
      const slotIndex = placed[wordIndex].indexOf(null);
      if(slotIndex === -1){ showMessage('This word is already complete. Use undo or reset to change.', true); return; }
      const ch = btn.dataset.letter;
      const slot = document.querySelector(`#target-${wordIndex} .slot[data-index="${slotIndex}"]`);
      slot.textContent = ch;
      placed[wordIndex][slotIndex] = { ch, btnId };
      btn.classList.add('disabled'); btn.disabled = true;
      history.push({ wordIndex, slotIndex, btnId });
      showMessage('', false);
    }

    document.getElementById('undoBtn').addEventListener('click', () => {
      if(history.length === 0){ showMessage('Nothing to undo.', true); return; }
      const last = history.pop();
      const { wordIndex, slotIndex, btnId } = last;
      const slot = document.querySelector(`#target-${wordIndex} .slot[data-index="${slotIndex}"]`);
      if(slot) slot.textContent = '';
      placed[wordIndex][slotIndex] = null;
      const btn = document.getElementById(btnId);
      if(btn){ btn.classList.remove('disabled'); btn.disabled = false; }
      showMessage('', false);
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      createUI();
      window.scrollTo({ top:0, behavior:'smooth' });
    });

    document.getElementById('checkBtn').addEventListener('click', () => {
      const formed = placed.map((arr, i) => {
        if(arr.some(a => a === null)) return null;
        return arr.map(a => a.ch).join('');
      });
      if(formed.some(f => f === null)){ showMessage('Complete all three words before checking.', true); return; }
      const correct = formed.every((f, i) => f.toUpperCase() === words[i].toUpperCase());
      if(correct) showMessage('Correct! Phrase formed: Almond Polaroid Cam', false);
      else {
        const wrong = formed.map((f,i) => f.toUpperCase() === words[i].toUpperCase() ? null : i).filter(x=>x!==null);
        showMessage('Some words are incorrect. Try again. Incorrect word(s): ' + wrong.map(i=>i+1).join(', '), true);
      }
    });

    function showMessage(text, err){
      const el = document.getElementById('message');
      if(!text){ el.style.display='none'; el.textContent=''; return; }
      el.style.display='block'; el.textContent = text;
      if(err){ el.style.background='rgba(255,100,100,0.08)'; el.style.color='rgba(255,180,180,0.95)'; }
      else { el.style.background='rgba(214,168,137,0.08)'; el.style.color='var(--accent)'; }
    }

    // recompute on resize to keep uniform sizing based on word2
    function debounce(fn, wait=120){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), wait); }; }
    window.addEventListener('resize', debounce(() => adjustUniformSizeFromWord2(), 100));

    // init
    createUI();
    window.addEventListener('load', () => setTimeout(adjustUniformSizeFromWord2, 120));
  </script>
</body>
</html>
